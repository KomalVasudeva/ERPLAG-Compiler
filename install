#! /bin/bash

BOLD='\033[1m'
GREEN='\033[1;32m'
CYAN='\033[1;36m'
RED='\033[1;31m'
RESET='\033[0m'

installErr () {
	printf "\n${BOLD}${RED}ERPLAG installation failed. \nPlease export repository directory to PATH variable.${RESET}\n"
	printf "Press enter to continue..."
	read
}

if [ -f /usr/local/bin/erplag ]
then
	printf "${BOLD}${GREEN}ERPLAG compiler is already installed in this system${RESET}\n\n" 
	printf "Please use ${BOLD}${CYAN}./rebuild ${RESET}to quickly remake the compiler\n"
	printf "Otherwise, use ${BOLD}${CYAN}./uninstall ${RESET} to uninstall the compiler\n"

	exit
fi

sudo printf "Installing ERPLAG... \n\n"

if [[ "$OSTYPE" == "linux-gnu"* ]]
then
	sudo apt-get update
	sudo apt-get install build-essential
	sudo apt-get install nasm
elif [[ "$OSTYPE" == "darwin"* ]]
then
	var=$(sudo which brew) 
	if test "$var" == ""
	then
		/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install.sh)"
	fi

	brew update
	brew install gcc
	brew install make
	brew install nasm
else
    printf "${BOLD}${RED}ERPLAG has not been designed for this OS. Please use a linux distribution or MacOS${RESET}\n"
    printf "Press enter to continue..."
	read
    exit
fi

make

sudo cp erplag /usr/local/bin
stat=$?
if [ $stat -ne 0 ]
then
	installErr 
	exit
fi

sudo cp .compiler /usr/local/bin
stat=$?
if [ $stat -ne 0 ]
then
	installErr 
	exit
fi

sudo cp erpclr /usr/local/bin
stat=$?
if [ $stat -ne 0 ]
then
	installErr 
	exit
fi

make clean

printf "\n${BOLD}${GREEN}ERPLAG compiler has been successfully installed!${RESET}\n"
printf "Use ${BOLD}${CYAN}erplag -h ${RESET}to read the guidelines for using the compiler\n"
printf "\nPress enter to continue..."
read
